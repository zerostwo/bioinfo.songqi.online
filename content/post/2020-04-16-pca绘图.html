---
title: PCA绘图
author: Songqi Duan
date: '2020-04-16'
slug: pca
categories:
  - 生物信息学
tags:
  - R
lastmod: '2020-04-16T21:52:16+08:00'
keywords: []
description: ''
comment: true
postMetaInFooter: true
hiddenFromHomePage: false
contentCopyright: false
reward: false
mathjax: false
mathjaxEnableSingleDollar: false
mathjaxEnableAutoNumber: false
hideHeaderAndFooter: false
flowchartDiagrams:
  enable: false
  options: ''
sequenceDiagrams:
  enable: false
  options: ''
output:
  blogdown::html_page:
    toc: true
---



<p>使用R语言进行PCA绘图<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>构建绘图数据</p>
<pre class="r"><code>data.matrix &lt;- matrix(nrow=100, ncol=10)
colnames(data.matrix) &lt;- c(
  paste(&quot;wt&quot;, 1:5, sep=&quot;&quot;),
  paste(&quot;ko&quot;, 1:5, sep=&quot;&quot;)
)
rownames(data.matrix) &lt;- c(
  paste(&quot;gene&quot;, 1:100, sep=&quot;&quot;)
)
for (i in 1:100) {
  wt.values &lt;- rpois(5, lambda=sample(x=10:1000, size=1))
  ko.values &lt;- rpois(5, lambda=sample(x=10:1000, size=1))
  data.matrix[i,] &lt;- c(wt.values, ko.values)
}</code></pre>
<p><code>procomp</code>默认样本为行，基因为列，因此在这里需要转置</p>
<pre class="r"><code>pca &lt;- prcomp(t(data.matrix), scale=TRUE)
str(pca) # return x, sdev and rotation</code></pre>
<pre><code>## List of 5
##  $ sdev    : num [1:10] 9.44 1.68 1.36 1.3 1.12 ...
##  $ rotation: num [1:100, 1:10] -0.1055 0.0883 -0.1058 0.1035 0.1006 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:100] &quot;gene1&quot; &quot;gene2&quot; &quot;gene3&quot; &quot;gene4&quot; ...
##   .. ..$ : chr [1:10] &quot;PC1&quot; &quot;PC2&quot; &quot;PC3&quot; &quot;PC4&quot; ...
##  $ center  : Named num [1:100] 545 821 555 308 270 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:100] &quot;gene1&quot; &quot;gene2&quot; &quot;gene3&quot; &quot;gene4&quot; ...
##  $ scale   : Named num [1:100] 424.6 47.1 415.8 82.5 47.8 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:100] &quot;gene1&quot; &quot;gene2&quot; &quot;gene3&quot; &quot;gene4&quot; ...
##  $ x       : num [1:10, 1:10] -8.87 -9.5 -8.85 -8.76 -8.8 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:10] &quot;wt1&quot; &quot;wt2&quot; &quot;wt3&quot; &quot;wt4&quot; ...
##   .. ..$ : chr [1:10] &quot;PC1&quot; &quot;PC2&quot; &quot;PC3&quot; &quot;PC4&quot; ...
##  - attr(*, &quot;class&quot;)= chr &quot;prcomp&quot;</code></pre>
<p>取第一主成分和第二主成分</p>
<pre class="r"><code>plot(pca$x[,1], pca$x[,2]) </code></pre>
<p><img src="/post/2020-04-16-pca%E7%BB%98%E5%9B%BE_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li><p>第一主成分解释了原始数据（所有10个样本的基因表达）中最大的方差</p></li>
<li><p>第二主成分解释了…第二大方差，以此类推</p></li>
</ul>
<p>让我们看看PC1能解释原始数据多大的方差，因此我们使用<code>sdev</code>(标准差)的平方</p>
<p>标准差的平方是方差</p>
<pre class="r"><code>pca.var &lt;- pca$sdev^2
pca.var.per &lt;- round(pca.var/sum(pca.var)*100, 1)
barplot(pca.var.per, 
        main=&quot;Scree Plot&quot;, xlab=&quot;Principal Component&quot;,
        ylab=&quot;Percent Variation&quot;)</code></pre>
<p><img src="/post/2020-04-16-pca%E7%BB%98%E5%9B%BE_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>library(ggplot2)
pca.data &lt;- data.frame(
  Sample=rownames(pca$x),
  X=pca$x[,1],
  Y=pca$x[,2]
)

ggplot(data=pca.data, mapping = aes(x=X, y=Y, label=Sample)) +
  geom_text() + 
  xlab(paste(&quot;PC1 - &quot;, pca.var.per[1], &quot;%&quot;, sep=&quot;&quot;)) + 
  ylab(paste(&quot;PC2 - &quot;, pca.var.per[2], &quot;%&quot;, sep=&quot;&quot;)) + 
  theme_bw() +
  ggtitle(&quot;My PCA Graph&quot;)</code></pre>
<p><img src="/post/2020-04-16-pca%E7%BB%98%E5%9B%BE_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>下面我们可以通过<code>pca$rotation</code>来看什么基因对结果影响最大</p>
<pre class="r"><code>loading_scores &lt;- pca$rotation[,1] # 这里使用第一列因为PC1的对原始数据的影响达到91%
gene_scores &lt;- abs(loading_scores)
gene_score_ranked &lt;- sort(gene_scores, decreasing=TRUE)
top_10_genes &lt;- names(gene_score_ranked[1:10])
top_10_genes</code></pre>
<pre><code>##  [1] &quot;gene14&quot; &quot;gene82&quot; &quot;gene49&quot; &quot;gene3&quot;  &quot;gene77&quot; &quot;gene88&quot; &quot;gene53&quot; &quot;gene57&quot;
##  [9] &quot;gene10&quot; &quot;gene16&quot;</code></pre>
<p>查看造成<code>wt</code>与<code>ko</code>不一样的关键基因</p>
<pre class="r"><code>pca$rotation[top_10_genes,1]</code></pre>
<pre><code>##     gene14     gene82     gene49      gene3     gene77     gene88     gene53 
## -0.1058454  0.1058438 -0.1058393 -0.1058189 -0.1058107  0.1057997  0.1057940 
##     gene57     gene10     gene16 
##  0.1057891 -0.1057807 -0.1057766</code></pre>
<p>得到的结果说明，<code>PC1</code>下得分为正的是将<code>ko</code>推向PCA Graph右边的关键基因</p>
<p>为负的则是将<code>wt</code>推向左边的关键基因</p>
<p>说明这些基因是造成<code>wt</code>和<code>ko</code>不同的差异性表达基因</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://www.youtube.com/watch?v=0Jp4gsfOLMs&amp;list=PLblh5JKOoLUJJpBNfk8_YadPwDTO2SCbx">StatQuest: PCA in R</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
